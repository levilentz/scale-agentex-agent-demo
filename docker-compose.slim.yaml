version: '3.8'

# Docker Compose file to run AgentEx backend + UI
# Usage: docker-compose up --build
#
# This includes:
# - AgentEx backend API and all infrastructure (Temporal, Redis, MongoDB, PostgreSQL)
# - AgentEx UI (Next.js frontend)
#
# Services will be available at:
# - AgentEx API: http://localhost:5003
# - AgentEx UI: http://localhost:3000
# - Temporal UI: http://localhost:8080

services:

  # =============================================================================
  # Agents
  # =============================================================================

  web-search:
    build:
      context: ${PWD}
      dockerfile: web_search/Dockerfile.slim
    environment:
      - PYTHONPATH=/app
      - AGENTEX_API_BASE_URL=http://agentex:5003
      - AGENTEX_BASE_URL=http://agentex:5003
      - TEMPORAL_ADDRESS=agentex-temporal:7233
      - AGENT_NAME=web-search
      - ACP_URL=http://web-search
      - ACP_PORT=8000
      - ACP_TYPE=sync
      - REDIS_URL=redis://agentex-redis:6379
      - SGP_API_KEY=${SGP_API_KEY}
      - SGP_BASE_URL=${SGP_BASE_URL}
      - SGP_ACCOUNT_ID=${SGP_ACCOUNT_ID}
    container_name: web-search
    depends_on:
      agentex:
        condition: service_healthy
    networks:
      - agentex-network
    restart: unless-stopped

  patient-enrollment:
    build:
      context: ${PWD}
      dockerfile: patient_enrollment/Dockerfile.slim
    environment:
      - PYTHONPATH=/app
      - AGENTEX_API_BASE_URL=http://agentex:5003
      - AGENTEX_BASE_URL=http://agentex:5003
      - TEMPORAL_ADDRESS=agentex-temporal:7233
      - AGENT_NAME=patient-enrollment
      - ACP_URL=http://patient-enrollment
      - ACP_PORT=8000
      - ACP_TYPE=sync
      - REDIS_URL=redis://agentex-redis:6379
      - SGP_API_KEY=${SGP_API_KEY}
      - SGP_BASE_URL=${SGP_BASE_URL}
      - SGP_ACCOUNT_ID=${SGP_ACCOUNT_ID}
    container_name: patient-enrollment
    depends_on:
      agentex:
        condition: service_healthy
    networks:
      - agentex-network
    restart: unless-stopped
